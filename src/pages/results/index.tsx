import { ActionPlanEl } from "@/components/sections/ActionPlan";
import { AidChance } from "@/components/sections/AidChance";
import { AvailableBonuses } from "@/components/sections/AvailableBonuses";
import ProfileRatingCard from "@/components/sections/ProfileRatingCard";
import Ratings from "@/components/sections/Ratings";
import UnisCard from "@/components/sections/UnisCard";
import CountriesCard from "@/components/ui/Countries/CoutriesCard";
import { $api } from "@/http/api";
import { ProfileScores } from "@/types";
import dayjs from "dayjs";
import { Inter } from "next/font/google";
import Head from "next/head";
import { useSearchParams } from "next/navigation";
import { useEffect, useState } from "react";

const inter = Inter({
  subsets: ["latin", "cyrillic"],
  weight: ["100", "200", "300", "400", "500", "600", "700", "800", "900"],
  display: "swap",
});
export default function ResultsPage() {
  const params = useSearchParams()
  const id = params.get("id")

  const [profile, setProfile] = useState<ProfileScores | null>(null)
  // ad38d9fa-ad27-4117-b028-a15094155e75
  useEffect(() => {
    if (!id) return
    const apiFetch = async () => {
      const res = await $api.get(`/profiles/scores/${id}`);
      setProfile(res);
    };
    apiFetch();
  }, [id]);
  return (
    <>
      <Head>
        <title>LET ME STUDY | Results</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
      </Head>
      {profile && (
        <div className={` ${inter.className}`}>
          <main className="min-h-screen bg-gray-50">
            <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
              <div className="mb-6 sm:mb-8">
                <h1 className="text-3xl font-bold">impact AI</h1>
                <p className="text-gray-500 mt-1 text-sm">
                  Ваші результати від @impact.admissions
                </p>
                <p className="text-gray-500 mt-2 text-sm">
                  {profile?.name} {profile?.surname} ·{" "}
                  {dayjs(new Date()).format("DD.MM.YYYY")}
                </p>
              </div>
              <div className="space-y-6 sm:space-y-8">
                <Ratings profile={profile} />
                <ProfileRatingCard profile={profile} />
                <CountriesCard profile={profile} />
                <UnisCard profile={profile} />
                <AidChance
                  score={
                    profile?.scores?.profileSummary?.overallProfileScore || 0
                  }
                />
                <ActionPlanEl plan={profile.aiText.actionPlan} />
                <AvailableBonuses />
              </div>
            </div>
          </main>
        </div>
      )}
    </>
  );
}
